const handleLogin = async () => {
      if (!username || !password) {
        Alert.default.alert('Error', 'Please enter both username and password');
        return;
      }
      setLoading(true);
      const loginUrl = `${_apiClient.API_BASE_URL}/api/login`;
      console.log('üîê Attempting login with:', {
        username,
        apiUrl: _apiClient.API_BASE_URL,
        fullUrl: loginUrl,
        hostname: typeof window !== 'undefined' ? window.location.hostname : 'N/A',
        protocol: typeof window !== 'undefined' ? window.location.protocol : 'N/A',
        port: typeof window !== 'undefined' ? window.location.port : 'N/A'
      });
      try {
        const response = await fetch(loginUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            username,
            password
          })
        });
        console.log('üì° Login response status:', response.status);
        console.log('üì° Response headers:', response.headers);

        // Check if response is actually JSON
        const contentType = response.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
          const text = await response.text();
          console.error('‚ùå Non-JSON response received:', text.substring(0, 200));
          throw new Error('Server returned invalid response. Please check if backend is running on port 8000.');
        }
        if (!response.ok) {
          const errorData = await response.json().catch(() => ({}));
          console.error('‚ùå Login failed:', errorData);
          throw new Error(errorData.detail || 'Invalid username or password');
        }
        const data = await response.json();
        console.log('‚úÖ Login successful:', data);
        await _utilsStorage.storage.setUserData(data);
        if (!data.branches || data.branches.length === 0) {
          Alert.default.alert('Error', 'You are not assigned to any branch. Please contact your administrator.');
          return;
        }
        setUserBranches(data.branches);
        if (data.branches.length === 1) {
          await setActiveBranch(data.branches[0]);
          navigation.replace('Home');
        } else {
          navigation.replace('BranchSelection');
        }
      } catch (error) {
        console.error('‚ùå Login error:', error);
        let errorMessage = error.message || 'Invalid username or password';

        // Check if it's a network/connection error
        if (error.message === 'Failed to fetch' || error.name === 'TypeError') {
          errorMessage = `Cannot connect to backend server.\n\nBackend URL: ${_apiClient.API_BASE_URL}\n\nPlease ensure:\n1. Backend server is running (port 8000)\n2. Click the Run button to start both servers\n3. Wait for "Uvicorn running on http://0.0.0.0:8000" message\n\nIf issue persists, check the console logs for API URL details.`;
        }
        Alert.default.alert('Login Failed', errorMessage);
      } finally {
        setLoading(false);
      }
    };